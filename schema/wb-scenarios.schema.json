{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "title": "Automation scenarios",
  "configFile": {
    "path": "/etc/wb-scenarios.conf",
    "service": "wb-rules"
  },
  "options": {
    "wb": {
      "disable_title": true
    }
  },
  "definitions": {
    "scenario": {
      "title": "Scenario",
      "headerTemplate": "{{ self.name }}",
      "oneOf": [
        {
          "$ref": "#/definitions/devicesControl"
        },
        {
          "$ref": "#/definitions/darkroom"
        }
      ],
      "_format": "wb-multiple",
      "options": {
        "keep_oneof_values": false,
        "disable_collapse": true,
        "disable_edit_json": true,
        "disable_properties": true,
        "wb": {
          "disable_panel": true
        }
      }
    },
    "devicesControl": {
      "title": "Devices control",
      "type": "object",
      "description": "devicesControl_description",
      "_format": "grid",
      "properties": {
        "scenarioType": {
          "type": "string",
          "enum": [
            "devicesControl"
          ],
          "default": "devicesControl",
          "options": {
            "hidden": true
          }
        },
        "enable": {
          "title": "enable_title",
          "type": "boolean",
          "default": true,
          "_format": "checkbox",
          "propertyOrder": 1,
          "options": {
            "grid_columns": 12
          }
        },
        "name": {
          "title": "generalScenarioName",
          "type": "string",
          "default": "Управление устройствами",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 2,
          "options": {
            "grid_columns": 12
          }
        },
        "id_prefix": {
          "title": "id_prefix_title",
          "type": "string",
          "description": "id_prefix_description",
          "_pattern_comment": "Запрещает пробелы, /, +, и #, а также ограничивает строку использованием только цифр, нижнего подчеркивания и английских букв",
          "pattern": "^[0-9a-zA-Z_]+$",
          "default": "devices_control",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 3,
          "options": {
            "grid_columns": 12,
            "patternmessage": "generalErrorRegexpPatternMessage"
          }
        },
        "inControls": {
          "title": "inControls_arr_title",
          "type": "array",
          "minItems": 1,
          "propertyOrder": 4,
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "inControls_arr_description",
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "inControls_obj_title",
            "type": "object",
            "properties": {
              "control": {
                "type": "string",
                "propertyOrder": 1,
                "title": "generalMqttTopicNameTitle",
                "description": "generalMqttTopicNameDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                "patternmessage": "generalErrorRegexpPatternMessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "behaviorType": {
                "type": "string",
                "propertyOrder": 2,
                "title": "generalBehaviorTypeTitle",
                "enum": [
                  "whenChange",
                  "whenDisabled",
                  "whenEnabled"
                ],
                "default": "whenChange",
                "options": {
                  "enum_titles": [
                    "When Change",
                    "When Disabled (switch)",
                    "When Enabled (switch)"
                  ]
                }
              }
            },
            "required": [
              "control",
              "behaviorType"
            ]
          }
        },
        "outControls": {
          "type": "array",
          "minItems": 1,
          "propertyOrder": 5,
          "_title_note": "When options-> compact: true - this title not shown",
          "title": "outControls_arr_title",
          "description": "outControls_arr_description",
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "outControls_obj_title",
            "type": "object",
            "properties": {
              "control": {
                "type": "string",
                "propertyOrder": 1,
                "title": "generalMqttTopicNameTitle",
                "description": "generalMqttTopicNameDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "generalErrorRegexpPatternMessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "behaviorType": {
                "type": "string",
                "propertyOrder": 2,
                "title": "outControls_behaviorType_title",
                "enum": [
                  "toggle",
                  "setEnable",
                  "setDisable",
                  "setValue",
                  "increaseValueBy",
                  "decreaseValueBy"
                ],
                "default": "setDisable",
                "options": {
                  "enum_titles": [
                    "Toggle (switch)",
                    "Enable (switch)",
                    "Disable (switch)",
                    "generalEnumSetValue",
                    "Increase Value By",
                    "Decrease Value By"
                  ]
                }
              },
              "actionValue": {
                "type": "number",
                "propertyOrder": 3,
                "title": "outControls_actionValue_title",
                "description": "outControls_actionValue_description",
                "default": 0
              }
            },
            "required": [
              "control",
              "behaviorType"
            ]
          }
        }
      },
      "required": [
        "scenarioType",
        "enable",
        "name",
        "id_prefix",
        "inControls",
        "outControls"
      ]
    },
    "darkroom": {
      "title": "darkroomScenarioName",
      "type": "object",
      "description": "darkroomScenarioDescription",
      "_format": "grid",
      "properties": {
        "componentVersion": {
          "type": "integer",
          "title": "Config version",
          "minimum": 1,
          "maximum": 256,
          "default": 1,
          "options": {
            "hidden": true
          }
        },
        "scenarioType": {
          "type": "string",
          "enum": [
            "darkroom"
          ],
          "default": "darkroom",
          "options": {
            "hidden": true
          }
        },
        "enable": {
          "title": "enable_title",
          "type": "boolean",
          "default": true,
          "_format": "checkbox",
          "propertyOrder": 1,
          "options": {
            "grid_columns": 12
          }
        },
        "name": {
          "title": "generalScenarioName",
          "type": "string",
          "default": "Темная комната",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 2,
          "options": {
            "grid_columns": 12
          }
        },
        "id_prefix": {
          "title": "id_prefix_title",
          "type": "string",
          "description": "id_prefix_description",
          "_pattern_comment": "Запрещает пробелы, /, +, и #, а также ограничивает строку использованием только цифр, нижнего подчеркивания и английских букв",
          "pattern": "^[0-9a-zA-Z_]+$",
          "default": "darkroom",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 3,
          "options": {
            "grid_columns": 12,
            "patternmessage": "generalErrorRegexpPatternMessage"
          }
        },
        "delayByMotionSensors": {
          "type": "number",
          "title": "darkroomDelayByMotionSensorsTitle",
          "default": 120,
          "propertyOrder": 4,
          "options": {
            "grid_columns": 12
          }
        },
        "delayByOpeningSensors": {
          "type": "number",
          "title": "darkroomDelayByOpeningSensorsTitle",
          "default": 180,
          "propertyOrder": 5,
          "options": {
            "grid_columns": 12
          }
        },
        "delayBlockAfterSwitch": {
          "type": "number",
          "title": "darkroomdelayBlockAfterSwitch",
          "default": 3600,
          "propertyOrder": 6,
          "options": {
            "grid_columns": 12
          }
        },
        "lightDevices": {
          "type": "array",
          "title": "darkroomLightDevicesArrTitle",
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "darkroomLightDevicesArrDescription",
          "minItems": 1,
          "propertyOrder": 7,
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "darkroomLightDevicesObjTitle",
            "type": "object",
            "properties": {
              "mqttTopicName": {
                "type": "string",
                "propertyOrder": 1,
                "title": "generalMqttTopicNameTitle",
                "description": "generalMqttTopicNameDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "generalErrorRegexpPatternMessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "behaviorType": {
                "type": "string",
                "propertyOrder": 2,
                "title": "outControls_behaviorType_title",
                "enum": [
                  "setEnable",
                  "setValueNumeric"
                ],
                "default": "setEnable",
                "options": {
                  "enum_titles": [
                    "Enable (switch)",
                    "generalEnumSetValue"
                  ]
                }
              },
              "actionValue": {
                "type": "number",
                "propertyOrder": 3,
                "title": "outControls_actionValue_title",
                "description": "outControls_actionValue_description",
                "default": 0,
                "options": {
                  "dependencies": {
                    "behaviorType": ["setValueNumeric"]
                  }
                }
              }
            },
            "required": [
              "mqttTopicName",
              "behaviorType"
            ]
          }
        },
        "motionSensors": {
          "type": "array",
          "title": "darkroomMotionSensorsArrTitle",
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "darkroomMotionSensorsArrDescription",
          "propertyOrder": 8,
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "type": "object",
            "title": "darkroomMotionSensorsObjTitle",
            "properties": {
              "mqttTopicName": {
                "type": "string",
                "propertyOrder": 1,
                "title": "generalMqttTopicNameTitle",
                "description": "generalMqttTopicNameDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "generalErrorRegexpPatternMessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "behaviorType": {
                "type": "string",
                "title": "darkroomMotionSensorsObjBehaviorTypeTitle",
                "enum": [
                  "whileValueHigherThanThreshold",
                  "whenEnabled"
                ],
                "options": {
                  "enum_titles": [
                    "darkroomMotionSensorsEnumWhileValue",
                    "darkroomMotionSensorsEnumWhenEnabled"
                  ]
                },
                "default": "whileValueHigherThanThreshold",
                "propertyOrder": 2
              },
              "actionValue": {
                "type": "number",
                "title": "darkroomMotionSensorsObjActionValueTitle",
                "default": 170,
                "propertyOrder": 3,
                "options": {
                  "dependencies": {
                    "behaviorType": ["whileValueHigherThanThreshold"]
                  }
                }
              }
            },
            "required": [
              "mqttTopicName",
              "behaviorType"
            ]
          }
        },
        "openingSensors": {
          "type": "array",
          "title": "darkroomOpeningSensorsArrTitle",
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "darkroomOpeningSensorsArrDescription",
          "propertyOrder": 9,
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "darkroomOpeningSensorsObjTitle",
            "type": "object",
            "properties": {
              "mqttTopicName": {
                "type": "string",
                "propertyOrder": 1,
                "title": "generalMqttTopicNameTitle",
                "description": "generalMqttTopicNameDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "generalErrorRegexpPatternMessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "behaviorType": {
                "type": "string",
                "propertyOrder": 2,
                "title": "generalBehaviorTypeTitle",
                "enum": [
                  "whenDisabled",
                  "whenEnabled"
                ],
                "default": "whenEnabled",
                "options": {
                  "enum_titles": [
                    "darkroomOpeningSensorsEnumWhenDisabled",
                    "darkroomOpeningSensorsEnumWhenEnabled"
                  ]
                }
              }
            },
            "required": [
              "mqttTopicName",
              "behaviorType"
            ]
          }
        },
        "lightSwitches": {
          "type": "array",
          "title": "darkroomLightSwitchesArrTitle",
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "darkroomLightSwitchesArrDescription",
          "propertyOrder": 10,
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "darkroomLightSwitchesObjTitle",
            "type": "object",
            "properties": {
              "mqttTopicName": {
                "type": "string",
                "propertyOrder": 1,
                "title": "generalMqttTopicNameTitle",
                "description": "generalMqttTopicNameDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "generalErrorRegexpPatternMessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              }
            },
            "required": [
              "mqttTopicName"
            ]
          }
        }
      },
      "required": [
        "scenarioType",
        "enable",
        "name",
        "id_prefix",
        "motionSensors",
        "openingSensors",
        "lightDevices"
      ]
    }
  },
  "properties": {
    "configVersion": {
      "type": "integer",
      "title": "Config version",
      "minimum": 1,
      "maximum": 256,
      "default": 1,
      "options": {
        "hidden": true
      }
    },
    "scenarios": {
      "type": "array",
      "title": "Scenarios",
      "items": {
        "$ref": "#/definitions/scenario"
      },
      "options": {
        "disable_collapse": true,
        "disable_array_reorder": true,
        "disable_array_delete_last_row": true,
        "enable_array_copy": true
      },
      "_format": "tabs"
    }
  },
  "required": [
    "scenarios"
  ],
  "translations": {
    "en": {
      "generalScenarioName": "Scenario name",
      "generalMqttTopicNameTitle": "MQTT topic name",
      "generalMqttTopicNameDescription": "In format: Device/Control",
      "generalBehaviorTypeTitle": "Trigger logic",
      "generalErrorRegexpPatternMessage": "Value must be valid",
      "generalEnumSetValue": "Set Value",
      "enable_title": "Turn on the scenario",
      "devicesControl_description": "The script allows you to control one or more devices.<br>It is suitable for managing lighting, curtains, and other devices.",
      "id_prefix_title": "MQTT id of the device",
      "id_prefix_description": "Used as part of the topic. Only Latin characters, digits and underscore are allowed. Maximum length is 120.",
      "inControls_arr_title": "Triggers",
      "inControls_obj_title": "Trigger",
      "inControls_arr_description": "Any of the events listed here will trigger the automation.",
      "outControls_arr_title": "Actions",
      "outControls_obj_title": "Action",
      "outControls_arr_description": "This list of actions will be executed sequentially when the automation is triggered.",
      "outControls_behaviorType_title": "Action logic",
      "outControls_actionValue_title": "Value",
      "outControls_actionValue_description": "If necessary",
      "darkroomScenarioName": "Dark room",
      "darkroomScenarioDescription": "This scenario is suitable for managing lighting in bathrooms, hallways,<br>storage rooms, and other spaces where light is used briefly, and manual<br>switching is inconvenient. Using motion sensors and opening sensors,<br>the light turns on automatically when entering the room and turns off<br>after a set time once it is empty.",
      "darkroomDelayByMotionSensorsTitle": "Turn-off delay when motion sensors are triggered (seconds)",
      "darkroomDelayByOpeningSensorsTitle": "Turn-off delay when opening sensors are triggered (seconds)",
      "darkroomdelayBlockAfterSwitch": "Turn-on delay for the light and scenario logic execution after using the switch (seconds)",
      "darkroomLightDevicesArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-light-devices.png\" height=\"30\">  Light devices</p>",
      "darkroomLightDevicesArrDescription": "This list of light devices will be enabled sequentially when the automation is triggered.",
      "darkroomLightDevicesObjTitle": "Light device",
      "darkroomMotionSensorsArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-motion-sensor.png\" height=\"30\">  Motion sensors</p>",
      "darkroomMotionSensorsArrDescription": "Any of the motion sensors listed here will trigger the automation.",
      "darkroomMotionSensorsObjTitle": "Motion sensor",
      "darkroomMotionSensorsObjBehaviorTypeTitle": "Sensor type",
      "darkroomMotionSensorsEnumWhileValue": "Value numeric",
      "darkroomMotionSensorsEnumWhenEnabled": "Discrete value",
      "darkroomMotionSensorsObjActionValueTitle": "Threshold motion level",
      "darkroomOpeningSensorsArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-opening-sensor.png\" height=\"30\">  Opening sensors</p>",
      "darkroomOpeningSensorsArrDescription": "Any of the opening sensors listed here will trigger the automation.",
      "darkroomOpeningSensorsObjTitle": "Opening sensor",
      "darkroomOpeningSensorsEnumWhenDisabled": "When disabled",
      "darkroomOpeningSensorsEnumWhenEnabled": "When ebabled",
      "darkroomLightSwitchesArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-light-switch.png\" height=\"30\">  Light switches</p>",
      "darkroomLightSwitchesArrDescription": "When the switch is pressed, the light turns on, and automatic light control is paused.<br>The control logic is automatically restored after a set time or upon pressing the switch again.",
      "darkroomLightSwitchesObjTitle": "Switch"
    },
    "ru": {
      "generalScenarioName": "Название сценария",
      "generalMqttTopicNameTitle": "Имя MQTT топика",
      "generalMqttTopicNameDescription": "В формате: Устройство/Контрол",
      "generalBehaviorTypeTitle": "Логика срабатывания",
      "generalErrorRegexpPatternMessage": "Значение должно быть корректным",
      "generalEnumSetValue": "Установить значение",
      "Automation scenarios": "Сценарии автоматизации",
      "Scenarios": "Сценарии",
      "Scenario": "Сценарий",
      "enable_title": "Включить сценарий",
      "devicesControl_description": "Сценарий позволяет управлять одним или несколькими устройствами.<br>Применим для управления освещением, шторами и другими устройствами.",
      "id_prefix_title": "Идентификатор устройства в MQTT",
      "id_prefix_description": "Используется как часть топика в MQTT, только латинские буквы, цифры и нижнее подчёркивание. Не более 120 символов.",
      "inControls_arr_title": "События",
      "inControls_obj_title": "Событие",
      "inControls_arr_description": "Любое из указанных здесь событий будет запускать автоматизацию.",
      "outControls_arr_title": "Действия",
      "outControls_obj_title": "Действие",
      "outControls_arr_description": "Этот список действий будет выполняться последовательно при запуске автоматизации.",
      "outControls_behaviorType_title": "Логика действия",
      "outControls_actionValue_title": "Значение",
      "outControls_actionValue_description": "Если необходимо",
      "Devices control": "Управление устройствами",
      "When Change": "Когда изменится",
      "When Disabled (switch)": "Когда отключилось (для переключателей)",
      "When Enabled (switch)": "Когда включилось (для переключателей)",
      "Toggle (switch)": "Переключить (для переключателей)",
      "Enable (switch)": "Включить (для переключателей)",
      "Disable (switch)": "Выключить (для переключателей)",
      "Increase Value By": "Увеличить значение на",
      "Decrease Value By": "Уменьшить  значение на",
      "darkroomScenarioName": "Темная комната",
      "darkroomScenarioDescription": "Сценарий подходит для управления освещением в ванных комнатах, коридорах,<br>кладовках и других помещениях,где свет используется кратковременно, а ручное<br>включение неудобно. Благодаря использованию датчиков движения и датчиков<br>открытия, свет автоматически включается при входе в помещение и выключается<br>через заданное время после того, как оно становится пустым.",
      "darkroomDelayByMotionSensorsTitle": "Задержка отключения при срабатывании датчиков движения (секунды)",
      "darkroomDelayByOpeningSensorsTitle": "Задержка отключения при срабатывании датчиков открытия (секунды)",
      "darkroomdelayBlockAfterSwitch": "Задержка включения света и логики сценария после использования выключателя (секунды)",
      "darkroomLightDevicesArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-light-devices.png\" height=\"30\">  Устройства освещения</p>",
      "darkroomLightDevicesArrDescription": "Этот список устройств освещения будет включен последовательно при запуске автоматизации.",
      "darkroomLightDevicesObjTitle": "Устройство освещения",
      "darkroomMotionSensorsArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-motion-sensor.png\" height=\"30\">  Датчики движения</p>",
      "darkroomMotionSensorsArrDescription": "Любой из указанных здесь датчиков движения будет запускать автоматизацию.",
      "darkroomMotionSensorsObjTitle": "Датчик движения",
      "darkroomMotionSensorsObjBehaviorTypeTitle": "Тип датчика",
      "darkroomMotionSensorsEnumWhileValue": "Числовое значение",
      "darkroomMotionSensorsEnumWhenEnabled": "Дискретное значение",
      "darkroomMotionSensorsObjActionValueTitle": "Пороговый уровень движения",
      "darkroomOpeningSensorsArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-opening-sensor.png\" height=\"30\">  Датчики открытия</p>",
      "darkroomOpeningSensorsArrDescription": "Любой из указанных здесь датчиков открытия будет запускать автоматизацию.",
      "darkroomOpeningSensorsObjTitle": "Датчик открытия",
      "darkroomOpeningSensorsEnumWhenDisabled": "Когда отключилось",
      "darkroomOpeningSensorsEnumWhenEnabled": "Когда включилось",
      "darkroomLightSwitchesArrTitle": "<p style=\"margin-top: 20px; margin-bottom: 0px; font-size: 24px; font-weight: bold\"><img src=\"images/scenario-darkroom-light-switch.png\" height=\"30\">  Выключатели света</p>",
      "darkroomLightSwitchesArrDescription": "При нажатии выключателя свет включается, а автоматическое управление<br>светом приостанавливается. Логика управления восстанавливается автоматически<br>через заданное время или после повторного нажатия выключателя.",
      "darkroomLightSwitchesObjTitle": "Выключатель"
    }
  }
}
