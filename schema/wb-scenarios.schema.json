{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "title": "Automation scenarios",
  "configFile": {
    "path": "/etc/wb-scenarios.conf",
    "service": "wb-rules"
  },
  "options": {
    "wb": {
      "disable_title": true
    }
  },
  "definitions": {
    "scenario": {
      "title": "Scenario",
      "headerTemplate": "{{ self.name }}",
      "oneOf": [
        {
          "$ref": "#/definitions/devicesControl"
        },
        {
          "$ref": "#/definitions/darkroom"
        }
      ],
      "_format": "wb-multiple",
      "options": {
        "keep_oneof_values": false,
        "disable_collapse": true,
        "disable_edit_json": true,
        "disable_properties": true,
        "wb": {
          "disable_panel": true
        }
      }
    },
    "devicesControl": {
      "title": "Devices control",
      "type": "object",
      "description": "devicesControl_description",
      "_format": "grid",
      "properties": {
        "scenarioConfigVersion": {
          "type": "integer",
          "title": "Config version",
          "minimum": 1,
          "maximum": 256,
          "default": 1,
          "options": {
            "hidden": true
          }
        },
        "scenarioType": {
          "type": "string",
          "enum": [
            "devicesControl"
          ],
          "default": "devicesControl",
          "options": {
            "hidden": true
          }
        },
        "enable": {
          "title": "enable_title",
          "type": "boolean",
          "default": true,
          "_format": "checkbox",
          "propertyOrder": 1,
          "options": {
            "grid_columns": 12
          }
        },
        "name": {
          "title": "generalScenarioName",
          "type": "string",
          "default": "Управление устройствами",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 2,
          "options": {
            "grid_columns": 12
          }
        },
        "id_prefix": {
          "title": "id_prefix_title",
          "type": "string",
          "description": "id_prefix_description",
          "_pattern_comment": "Запрещает пробелы, /, +, и #, а также ограничивает строку использованием только цифр, нижнего подчеркивания и английских букв",
          "pattern": "^[0-9a-zA-Z_]+$",
          "default": "devices_control",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 3,
          "options": {
            "grid_columns": 12,
            "patternmessage": "error_regexp_patternmessage"
          }
        },
        "inControls": {
          "title": "inControls_arr_title",
          "type": "array",
          "minItems": 1,
          "propertyOrder": 4,
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "inControls_arr_description",
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "inControls_obj_title",
            "type": "object",
            "properties": {
              "control": {
                "type": "string",
                "propertyOrder": 1,
                "title": "inControls_control_title",
                "description": "generalControlDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                "patternmessage": "error_regexp_patternmessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "behaviorType": {
                "type": "string",
                "propertyOrder": 2,
                "title": "inControls_behaviorType_title",
                "enum": [
                  "whenChange",
                  "whenDisabled",
                  "whenEnabled"
                ],
                "default": "whenChange",
                "options": {
                  "enum_titles": [
                    "When Change",
                    "When Disabled (switch)",
                    "When Enabled (switch)"
                  ]
                }
              }
            },
            "required": [
              "control",
              "behaviorType"
            ]
          }
        },
        "outControls": {
          "type": "array",
          "minItems": 1,
          "propertyOrder": 5,
          "_title_note": "When options-> compact: true - this title not shown",
          "title": "outControls_arr_title",
          "description": "outControls_arr_description",
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "outControls_obj_title",
            "type": "object",
            "properties": {
              "control": {
                "type": "string",
                "propertyOrder": 1,
                "title": "outControls_control_title",
                "description": "generalControlDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "error_regexp_patternmessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "behaviorType": {
                "type": "string",
                "propertyOrder": 2,
                "title": "outControls_behaviorType_title",
                "enum": [
                  "toggle",
                  "setEnable",
                  "setDisable",
                  "setValue",
                  "increaseValueBy",
                  "decreaseValueBy"
                ],
                "default": "setDisable",
                "options": {
                  "enum_titles": [
                    "Toggle (switch)",
                    "Enable (switch)",
                    "Disable (switch)",
                    "Set Value",
                    "Increase Value By",
                    "Decrease Value By"
                  ]
                }
              },
              "actionValue": {
                "type": "number",
                "propertyOrder": 3,
                "title": "outControls_actionValue_title",
                "description": "outControls_actionValue_description",
                "default": 0
              }
            },
            "required": [
              "control",
              "behaviorType"
            ]
          }
        }
      },
      "required": [
        "scenarioType",
        "enable",
        "name",
        "id_prefix",
        "inControls",
        "outControls"
      ]
    },
    "darkroom": {
      "title": "darkroomScenarioName",
      "type": "object",
      "description": "darkroomScenarioDescription",
      "_format": "grid",
      "properties": {
        "scenarioConfigVersion": {
          "type": "integer",
          "title": "Config version",
          "minimum": 1,
          "maximum": 256,
          "default": 1,
          "options": {
            "hidden": true
          }
        },
        "scenarioType": {
          "type": "string",
          "enum": [
            "darkroom"
          ],
          "default": "darkroom",
          "options": {
            "hidden": true
          }
        },
        "enable": {
          "title": "enable_title",
          "type": "boolean",
          "default": true,
          "_format": "checkbox",
          "propertyOrder": 1,
          "options": {
            "grid_columns": 12
          }
        },
        "name": {
          "title": "generalScenarioName",
          "type": "string",
          "default": "Темная комната",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 2,
          "options": {
            "grid_columns": 12
          }
        },
        "id_prefix": {
          "title": "id_prefix_title",
          "type": "string",
          "description": "id_prefix_description",
          "_pattern_comment": "Запрещает пробелы, /, +, и #, а также ограничивает строку использованием только цифр, нижнего подчеркивания и английских букв",
          "pattern": "^[0-9a-zA-Z_]+$",
          "default": "darkroom",
          "minLength": 1,
          "maxLength": 120,
          "propertyOrder": 3,
          "options": {
            "grid_columns": 12,
            "patternmessage": "error_regexp_patternmessage"
          }
        },
        "delayByMotionSensors": {
          "type": "number",
          "title": "darkroomDelayByMotionSensorsTitle",
          "default": 120,
          "propertyOrder": 4,
          "options": {
            "grid_columns": 12
          }
        },
        "delayByOpeningSensors": {
          "type": "number",
          "title": "darkroomDelayByOpeningSensorsTitle",
          "default": 180,
          "propertyOrder": 5,
          "options": {
            "grid_columns": 12
          }
        },    
        "motionSensors": {
          "type": "array",
          "title": "darkroomMotionSensorsArrTitle",
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "darkroomMotionSensorsArrDescription",
          "propertyOrder": 6,
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "type": "object",
            "title": "darkroomMotionSensorsObjTitle",
            "properties": {
              "control": {
                "type": "string",
                "propertyOrder": 1,
                "title": "darkroomMotionSensorsObjControlTitle",
                "description": "generalControlDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "error_regexp_patternmessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              },
              "thresholdMotionLevel": {
                "type": "number",
                "title": "darkroomMotionSensorsObjThresholdTitle",
                "default": 170,
                "propertyOrder": 2
              }
            },
            "required": [
              "control",
              "thresholdMotionLevel"
            ]
          }
        },
        "openingSensors": {
          "type": "array",
          "title": "darkroomOpeningSensorsArrTitle",
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "darkroomOpeningSensorsArrDescription",
          "propertyOrder": 7,
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "darkroomOpeningSensorsObjTitle",
            "type": "object",
            "properties": {
              "control": {
                "type": "string",
                "propertyOrder": 1,
                "title": "darkroomOpeningSensorsObjControlTitle",
                "description": "generalControlDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "error_regexp_patternmessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              }
            },
            "required": [
              "control"
            ]
          }
        },
        "lightDevices": {
          "type": "array",
          "title": "darkroomLightDevicesArrTitle",
          "_title_note": "When options-> compact: true - this title not shown",
          "description": "darkroomLightDevicesArrDescription",
          "minItems": 1,
          "propertyOrder": 8,
          "_format": "table",
          "options": {
            "disable_collapse": true,
            "grid_columns": 12,
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "wb": {
              "disable_panel": true
            }
          },
          "items": {
            "title": "darkroomLightDevicesObjTitle",
            "type": "object",
            "properties": {
              "control": {
                "type": "string",
                "propertyOrder": 1,
                "title": "darkroomLightDevicesObjControlTitle",
                "description": "generalControlDescription",
                "pattern": "^[^/+#]+/[^/+#]+$",
                "_format": "wb-autocomplete",
                "options": {
                  "patternmessage": "error_regexp_patternmessage",
                  "wb": {
                    "data": "devices"
                  }
                },
                "_minLength_note": "Device name (1) + slash (1) + topic name (1)",
                "minLength": 3
              }
            },
            "required": [
              "control"
            ]
          }
        }
      },
      "required": [
        "scenarioType",
        "enable",
        "name",
        "id_prefix",
        "motionSensors",
        "openingSensors",
        "lightDevices"
      ]
    }
  },
  "properties": {
    "generalConfigVersion": {
      "type": "integer",
      "title": "Config version",
      "minimum": 1,
      "maximum": 256,
      "default": 1,
      "options": {
        "hidden": true
      }
    },
    "scenarios": {
      "type": "array",
      "title": "Scenarios",
      "items": {
        "$ref": "#/definitions/scenario"
      },
      "options": {
        "disable_collapse": true,
        "disable_array_reorder": true,
        "disable_array_delete_last_row": true,
        "enable_array_copy": true
      },
      "_format": "tabs"
    }
  },
  "required": [
    "scenarios"
  ],
  "translations": {
    "en": {
      "generalScenarioName": "Scenario name",
      "generalControlDescription": "In format: Device/Control",
      "enable_title": "Turn on the scenario",
      "devicesControl_description": "The script allows you to control one or more devices.<br>It is suitable for managing lighting, curtains, and other devices.",
      "id_prefix_title": "MQTT id of the device",
      "id_prefix_description": "Used as part of the topic. Only Latin characters, digits and underscore are allowed. Maximum length is 120.",
      "inControls_arr_title": "Triggers",
      "inControls_obj_title": "Trigger",
      "inControls_arr_description": "Any of the events listed here will trigger the automation.",
      "inControls_control_title": "MQTT-topic",
      "inControls_behaviorType_title": "Trigger logic",
      "outControls_arr_title": "Actions",
      "outControls_obj_title": "Action",
      "outControls_arr_description": "This list of actions will be executed sequentially when the automation is triggered.",
      "outControls_control_title": "MQTT-topic",
      "outControls_behaviorType_title": "Action logic",
      "outControls_actionValue_title": "Value",
      "outControls_actionValue_description": "If necessary",
      "error_regexp_patternmessage": "Value must be valid",
      "darkroomScenarioName": "Dark room",
      "darkroomScenarioDescription": "The script allows you to control dark room",
      "darkroomDelayByMotionSensorsTitle": "Turn-off delay when motion sensors are triggered (seconds)",
      "darkroomDelayByOpeningSensorsTitle": "Turn-off delay when opening sensors are triggered (seconds)",
      "darkroomMotionSensorsArrTitle": "Motion sensors",
      "darkroomMotionSensorsArrDescription": "Any of the motion sensors listed here will trigger the automation.",
      "darkroomMotionSensorsObjTitle": "Motion sensor",
      "darkroomMotionSensorsObjControlTitle": "MQTT-topic",
      "darkroomMotionSensorsObjThresholdTitle": "Threshold motion level",
      "darkroomOpeningSensorsArrTitle": "Opening sensors",
      "darkroomOpeningSensorsArrDescription": "Any of the opening sensors listed here will trigger the automation.",
      "darkroomOpeningSensorsObjTitle": "Opening sensor",
      "darkroomOpeningSensorsObjControlTitle": "MQTT-topic",
      "darkroomLightDevicesArrTitle": "Light devices",
      "darkroomLightDevicesArrDescription": "This list of light devices will be enabled sequentially when the automation is triggered.",
      "darkroomLightDevicesObjTitle": "Light device",
      "darkroomLightDevicesObjControlTitle": "MQTT-topic"
    },
    "ru": {
      "generalScenarioName": "Название сценария",
      "generalControlDescription": "В формате: Устройство/Контрол",
      "Automation scenarios": "Сценарии автоматизации",
      "Scenarios": "Сценарии",
      "Scenario": "Сценарий",
      "enable_title": "Включить сценарий",
      "devicesControl_description": "Сценарий позволяет управлять одним или несколькими устройствами.<br>Применим для управления освещением, шторами и другими устройствами.",
      "id_prefix_title": "Идентификатор устройства в MQTT",
      "id_prefix_description": "Используется как часть топика в MQTT, только латинские буквы, цифры и нижнее подчёркивание. Не более 120 символов.",
      "inControls_arr_title": "События",
      "inControls_obj_title": "Событие",
      "inControls_arr_description": "Любое из указанных здесь событий будет запускать автоматизацию.",
      "inControls_control_title": "MQTT-топик",
      "inControls_behaviorType_title": "Логика срабатывания",
      "outControls_arr_title": "Действия",
      "outControls_obj_title": "Действие",
      "outControls_arr_description": "Этот список действий будет выполняться последовательно при запуске автоматизации.",
      "outControls_control_title": "MQTT-топик",
      "outControls_behaviorType_title": "Логика действия",
      "outControls_actionValue_title": "Значение",
      "outControls_actionValue_description": "Если необходимо",
      "error_regexp_patternmessage": "Значение должно быть корректным",
      "Devices control": "Управление устройствами",
      "When Change": "Когда изменится",
      "When Disabled (switch)": "Когда отключилось (для переключателей)",
      "When Enabled (switch)": "Когда включилось (для переключателей)",
      "Toggle (switch)": "Переключить (для переключателей)",
      "Enable (switch)": "Включить (для переключателей)",
      "Disable (switch)": "Выключить (для переключателей)",
      "Set Value": "Установить значение",
      "Increase Value By": "Увеличить значение на",
      "Decrease Value By": "Уменьшить  значение на",
      "darkroomScenarioName": "Темная комната",
      "darkroomScenarioDescription": "Сценарий позволяет управлять темной комнатой",
      "darkroomDelayByMotionSensorsTitle": "Задержка отключения при срабатывании датчиков движения (секунды)",
      "darkroomDelayByOpeningSensorsTitle": "Задержка отключения при срабатывании датчиков открытия (секунды)",
      "darkroomMotionSensorsArrTitle": "Датчики движения",
      "darkroomMotionSensorsArrDescription": "Любой из указанных здесь датчиков движени будет запускать автоматизацию.",
      "darkroomMotionSensorsObjTitle": "Датчик движения",
      "darkroomMotionSensorsObjControlTitle": "MQTT-топик",
      "darkroomMotionSensorsObjThresholdTitle": "Пороговый уровень движения",
      "darkroomOpeningSensorsArrTitle": "Датчики открытия",
      "darkroomOpeningSensorsArrDescription": "Любой из указанных здесь датчиков открытия будет запускать автоматизацию.",
      "darkroomOpeningSensorsObjTitle": "Датчик открытия",
      "darkroomOpeningSensorsObjControlTitle": "MQTT-топик",
      "darkroomLightDevicesArrTitle": "Устройства освещения",
      "darkroomLightDevicesArrDescription": "Этот список устройств освещения будет включен последовательно при запуске автоматизации.",
      "darkroomLightDevicesObjTitle": "Устройство освещения",
      "darkroomLightDevicesObjControlTitle": "MQTT-топик"
    }
  }
}
