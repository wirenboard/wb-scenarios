# Сценарий темной комнаты `darkroom`

Позволяет управлять темной комнатой
Удобен для реализации разных случаев:

1) Для автоматического включения света в комнатах временного прибывания
  - Коридор
  - Туалет
  - Ванная (могут быть проблеммы с определением движения за шторкой)

## Логики работы сценария

Сценарий может работать по одному из типов датчиков, либо сразу по двум
- Датчик движения
- Датчик открытия двери

Датчик открытия двери нужен для того чтобы свет включался мгновенно после того
как открылась дверь в помещение, и вы входили уже в освещенное помещение.

Есть один таймер выключения света - значение которого отображается в виртуальном устройстве

- При срабатывании датчика открытия двери включается свет и ставится таймер
  на отключение света равный установленному в настройках
- Далее при входе в помешение срабатывает один из датчиков движения, после
  чего старый таймер удаляется и включается свет бессрочно. Сценарий
  запоминает что находится в состоянии ожидания выключения и ждет окончания
  движения.
- Далее при детектировании остановки движени - ставится новый таймер
  на отключение и система сбрасывает состояние на начальное, в котором ничего
  не ждет.

Логика установки таймера на выключение именно при окончании движения важна
для беспроводных датчиков которые передают только true и false при
изменении состояния. Это нужно по двум причинам:
1) Необходима для корректной работы датчиков zeegbe
   Они могут находиться в состоянии true долго, дольше чем вы установите таймер
   Возможности обновлять таймер кроме как по изменению состояни на выкл нет
2) Уменьшают колличество активаций таймера датчиков со значением типа value
   Мы не обновляем таймер каждый раз при получении нового значения больше трешхолда
   а устанавливаем таймер только если движение уже не видно.
